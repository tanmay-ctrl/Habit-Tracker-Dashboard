<!doctype html>
<html>
<head>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js'></script>
    <title>HABIT & TASK manager</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        .page-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 200px;
            background-color: #0d5f42;
            padding: 20px 0;
            border-right: 1px solid #ddd;
            flex-shrink: 0;
        }

        .nav-item {
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            color: #f7f7f7;
            font-size: 16px;
            text-align: center;
        }

        .nav-item:hover {
            background-color: black;
        }

        .nav-item.active {
            background-color: black;
            font-weight: bold;
            color: white;
        }

        .content-area {
            flex-grow: 1;
            padding: 20px;
        }

        #calendar {
            margin: 30px 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        #calendar:hover {
            transform: scale(1.05);
            transition: transform 0.8s;
        }

        .chart {
            width: 500px;
            height: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .chart:hover {
            transform: scale(1.05);
            transition: transform 0.8s;
        }

        #habit-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
        }

        .habit-box {
            border: 1px solid #ccc;
            border-radius: 15px;
            padding: 30px;
            width: 200px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
            background-color: #f9f9f9;
        }

        .habit-box:hover {
            transform: scale(1.05);
            transition: transform 0.8s;
        }

        .habit-box.completed-today {
            border-color: #4CAF50;
            background-color: #b0ecb5;
        }

        .habit-name {
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .track-button,
        .completion-status {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            display: block;
            text-align: center;
        }

        .track-button {
            background-color: #2196F3;
            color: white;
        }

        .completion-status {
            color: #4CAF50;
            font-weight: bold;
        }

        #new-habit-area {
            font-size: 20px;
            border-radius: 15px;
            padding: 10px;
            width: 300px;
            background-color: #73de73;
            color: white;
        }
    </style>
</head>

<body style="background-color:#dfedef;">
    <img src="habitcover.png" alt="cover image" style="display:block; object-fit: cover; width:100%; height:30vh; margin-left:auto; margin-right:auto;">
    <h1 style="font-family:Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; font-size: 40px; color:#247110" align="center">HABIT & TASK MANAGER</h1>
    <hr>
    <div class="page-container">

        <aside class="sidebar">
            <a href="#" class="nav-item active">Homepage</a>
            <a href="#new-habit-area" class="nav-item">My Habits</a>
            <a href="#calendar" class="nav-item">calendar</a>
            <a href="#curve_chart" class="nav-item">Habit Graph</a>
        </aside>

        <main class="content-area" style="color:#c06a0e">
            <h2 align="center" style="color:#247110; font-size: 40px; font-style: italic; font-family:'Times New Roman', Times, serif;" id="random-message">Every day, it gets a little easier.<br>
            </h2>

            <div id="new-habit-area" style="padding: 20px;">
                <input type="text" id="habit-input" placeholder="Enter a new habit" style="padding:10px; border-radius:15px; border:none; width:150px; font-size:15px;">
                <button onclick="addHabit()" style="border-radius: 15px; border:none; padding:10px; width:100px;">Add Habit</button>
            </div>

            <div id="habit-container">
            </div>
            <hr>
            <div id="calendar"></div>

            <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
            <div id="curve_chart" class="chart"></div>
        </main>
    </div>

    <script>
        var calendar;
        const storageKey = 'myHabitData';

        function getTodayDateString() {
            return new Date().toISOString().split('T')[0];
        }

        function getHabitData() {
            const data = localStorage.getItem(storageKey);
            if (!data) {
                return { habits: [] };
            }
            return JSON.parse(data);
        }

        function saveHabitData(data) {
            localStorage.setItem(storageKey, JSON.stringify(data));
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeRandomMessage();
            initializeCalendar();
            renderHabitsFromStorage();
            loadCalendarEvents();
        });

        function initializeRandomMessage() {
            const message = [
                "We are what we repeatedly do. Excellence, then, is not an act, but a habit.",
                "Motivation is what gets you started. Habit is what keeps you going.",
                "The secret of getting ahead is getting started.",
                "Discipline is choosing between what you want now and what you want most."
            ];

            function getRandomIndex(max) {
                return Math.floor(Math.random() * max);
            }

            const randomIndex = getRandomIndex(message.length);
            const selectedmessage = message[randomIndex];
            const messageElement = document.getElementById("random-message");
            if (messageElement) {
                messageElement.innerHTML = selectedmessage;
            }
        }

        function initializeCalendar() {
            var calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                selectable: true,
                events: [],
                dateClick: function(info) {
                    console.log('Clicked on: ' + info.dateStr);
                }
            });
            calendar.render();
        }

        function loadCalendarEvents() {
            const data = getHabitData();
            let allEvents = [];

            data.habits.forEach(habit => {
                habit.completedDates.forEach(date => {
                    allEvents.push({
                        title: habit.name,
                        start: date
                    });
                });
            });

            calendar.addEventSource(allEvents);
        }

        function renderHabitsFromStorage() {
            const data = getHabitData();
            const habitContainer = document.getElementById('habit-container');
            habitContainer.innerHTML = '';
            const today = getTodayDateString();

            data.habits.forEach(habit => {
                const isCompletedToday = habit.completedDates.includes(today);

                const habitBox = document.createElement('div');
                habitBox.classList.add('habit-box');
                if (isCompletedToday) {
                    habitBox.classList.add('completed-today');
                }

                const nameSpan = document.createElement('span');
                nameSpan.classList.add('habit-name');
                nameSpan.textContent = habit.name;
                habitBox.appendChild(nameSpan);

                const streakSpan = document.createElement('span');
                streakSpan.classList.add('streak-count');
                streakSpan.textContent = `Streak: ${habit.streak}`;
                habitBox.appendChild(streakSpan);

                if (isCompletedToday) {
                    const completionStatus = document.createElement('span');
                    completionStatus.classList.add('completion-status');
                    completionStatus.textContent = 'Completed!';
                    habitBox.appendChild(completionStatus);
                } else {
                    const trackButton = document.createElement('button');
                    trackButton.classList.add('track-button');
                    trackButton.textContent = 'Track Day';
                    trackButton.setAttribute('onclick', 'trackHabit(this)');
                    habitBox.appendChild(trackButton);
                }

                habitContainer.appendChild(habitBox);
            });
        }

        function addHabit() {
            const input = document.getElementById('habit-input');
            const habitName = input.value.trim();

            if (habitName === "") {
                alert("Please enter a habit name.");
                return;
            }

            const data = getHabitData();

            if (data.habits.some(habit => habit.name === habitName)) {
                alert("This habit already exists!");
                return;
            }

            data.habits.push({
                name: habitName,
                streak: 0,
                completedDates: []
            });

            saveHabitData(data);
            renderHabitsFromStorage();
            input.value = '';
        }

        function trackHabit(buttonElement) {
            const habitBox = buttonElement.parentNode;
            const habitName = habitBox.querySelector('.habit-name').textContent;
            const streakSpan = habitBox.querySelector('.streak-count');
            const today = getTodayDateString();

            const data = getHabitData();

            const habit = data.habits.find(h => h.name === habitName);
            if (!habit) {
                return;
            }

            habit.completedDates.push(today);
            habit.streak++;
            saveHabitData(data);

            habitBox.classList.add('completed-today');
            buttonElement.style.display = 'none';

            const completionStatus = document.createElement('span');
            completionStatus.classList.add('completion-status');
            completionStatus.textContent = 'Completed!';
            habitBox.insertBefore(completionStatus, streakSpan);

            streakSpan.textContent = `Streak: ${habit.streak}`;

            calendar.addEvent({
                title: habit.name,
                start: today
            });

            drawChart();
        }

        google.charts.load('current', {
            'packages': ['corechart']
        });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            const habitData = getHabitData();

            const dataTable = [
                ['Date', 'Habits Completed']
            ];
            const completionsByDate = new Map();

            habitData.habits.forEach(habit => {
                habit.completedDates.forEach(date => {
                    const count = completionsByDate.get(date) || 0;
                    completionsByDate.set(date, count + 1);
                });
            });

            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);

                const dateString = d.toISOString().split('T')[0];
                const formattedDate = (d.getMonth() + 1) + '/' + d.getDate();

                const count = completionsByDate.get(dateString) || 0;
                dataTable.push([formattedDate, count]);
            }

            var data = google.visualization.arrayToDataTable(dataTable);

            var options = {
                title: 'Habit Completions (Last 7 Days)',
                curveType: 'function',
                legend: {
                    position: 'bottom'
                },
                colors: ['#0d5f42']
            };

            var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
            chart.draw(data, options);
        }
    </script>
</body>
</html>